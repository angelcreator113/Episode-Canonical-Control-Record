
> episode-metadata-api@1.0.0 test
> cross-env NODE_ENV=test jest --coverage --runInBand

FAIL tests/integration/episodes.integration.test.js
  ΓùÅ Console

    console.log
      ≡ƒÜÇ Starting Episode Metadata API...

      at Object.log (src/app.js:75:9)

    console.log
      ≡ƒôª Node version: v20.19.4

      at Object.log (src/app.js:76:9)

    console.log
      ≡ƒöº Environment: test

      at Object.log (src/app.js:77:9)

    console.log
      Γ£ô Auth routes loaded

      at Object.log (src/app.js:163:11)

    console.log
      Γ£ô Episodes routes loaded

      at Object.log (src/app.js:179:11)

    console.log
      Γ£ô Thumbnails routes loaded

      at Object.log (src/app.js:187:11)

    console.log
      Γ£ô Metadata routes loaded

      at Object.log (src/app.js:195:11)

    console.log
      Γ£ô Processing routes loaded

      at Object.log (src/app.js:203:11)

    console.log
      Γ£ô Files routes loaded

      at Object.log (src/app.js:212:11)

    console.log
      Γ£ô Search routes loaded

      at Object.log (src/app.js:220:11)

    console.log
      Γ£ô Jobs routes loaded

      at Object.log (src/app.js:228:11)

    console.log
      Γ£ô Assets routes loaded

      at Object.log (src/app.js:237:11)

    console.log
      Γ£ô Compositions routes loaded

      at Object.log (src/app.js:245:11)

    console.log
      Γ£ô Templates routes loaded

      at Object.log (src/app.js:253:11)

    console.log
      Γ£ô Seed routes loaded (development only)

      at Object.log (src/app.js:263:11)

    console.log
      Γ£à AWS SDK v3 configured with credentials from profile: default

      at log (src/routes/compositions.js:39:11)

  ΓùÅ Episodes API Integration Tests ΓÇ║ GET /api/v1/episodes ΓÇ║ should filter by status

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

      70 |         .query({ status: 'approved', page: 1, limit: 10 });
      71 |
    > 72 |       expect(res.status).toBe(200);
         |                          ^
      73 |       if (res.body.data.length > 0) {
      74 |         res.body.data.forEach(episode => {
      75 |           expect(episode.status?.toLowerCase()).toBe('approved');

      at Object.toBe (tests/integration/episodes.integration.test.js:72:26)

  ΓùÅ Episodes API Integration Tests ΓÇ║ GET /api/v1/episodes ΓÇ║ should handle multiple query parameters together

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

      116 |         });
      117 |
    > 118 |       expect(res.status).toBe(200);
          |                          ^
      119 |       expect(res.body).toHaveProperty('data');
      120 |       expect(res.body).toHaveProperty('pagination');
      121 |     });

      at Object.toBe (tests/integration/episodes.integration.test.js:118:26)

  ΓùÅ Episodes API Integration Tests ΓÇ║ End-to-End Episode Workflow ΓÇ║ should filter and browse episodes

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

      192 |         .query({ status: 'approved', page: 1, limit: 5 });
      193 |
    > 194 |       expect(approvedRes.status).toBe(200);
          |                                  ^
      195 |
      196 |       // Get pending episodes
      197 |       const pendingRes = await request(app)

      at Object.toBe (tests/integration/episodes.integration.test.js:194:34)

FAIL tests/unit/middleware/rbac.test.js
  ΓùÅ Edge Cases and Security Hardening ΓÇ║ should be case-sensitive for role names

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: 403

    Number of calls: 0

      624 |     middleware(req, res, next);
      625 |     
    > 626 |     expect(res.status).toHaveBeenCalledWith(403);
          |                        ^
      627 |   });
      628 |   
      629 |   it('should handle special characters in group names', () => {

      at Object.toHaveBeenCalledWith (tests/unit/middleware/rbac.test.js:626:24)

PASS tests/integration/assets.integration.test.js
  ΓùÅ Console

    console.log
      ≡ƒÜÇ Starting Episode Metadata API...

      at Object.log (src/app.js:75:9)

    console.log
      ≡ƒôª Node version: v20.19.4

      at Object.log (src/app.js:76:9)

    console.log
      ≡ƒöº Environment: test

      at Object.log (src/app.js:77:9)

    console.log
      Γ£ô Auth routes loaded

      at Object.log (src/app.js:163:11)

    console.log
      Γ£ô Episodes routes loaded

      at Object.log (src/app.js:179:11)

    console.log
      Γ£ô Thumbnails routes loaded

      at Object.log (src/app.js:187:11)

    console.log
      Γ£ô Metadata routes loaded

      at Object.log (src/app.js:195:11)

    console.log
      Γ£ô Processing routes loaded

      at Object.log (src/app.js:203:11)

    console.log
      Γ£ô Files routes loaded

      at Object.log (src/app.js:212:11)

    console.log
      Γ£ô Search routes loaded

      at Object.log (src/app.js:220:11)

    console.log
      Γ£ô Jobs routes loaded

      at Object.log (src/app.js:228:11)

    console.log
      Γ£ô Assets routes loaded

      at Object.log (src/app.js:237:11)

    console.log
      Γ£ô Compositions routes loaded

      at Object.log (src/app.js:245:11)

    console.log
      Γ£ô Templates routes loaded

      at Object.log (src/app.js:253:11)

    console.log
      Γ£ô Seed routes loaded (development only)

      at Object.log (src/app.js:263:11)

    console.log
      Γ£à AWS SDK v3 configured with credentials from profile: default

      at log (src/routes/compositions.js:39:11)

    console.log
      ≡ƒôñ Uploading to S3: promotional/lala/raw/1767744677192-292fb171-4dfd-42cf-a7cd-4a8d714c3896.jpg

      at AssetService.log [as uploadAsset] (src/services/AssetService.js:58:17)

    console.log
      Γ£à S3 upload successful: promotional/lala/raw/1767744677192-292fb171-4dfd-42cf-a7cd-4a8d714c3896.jpg

      at AssetService.log [as uploadAsset] (src/services/AssetService.js:72:17)

    console.log
      ≡ƒôñ Uploading to S3: promotional/justawomaninperprime/raw/1767744677548-d6e8afcd-9362-4657-b822-81a07bfb86d2.jpg

      at AssetService.log [as uploadAsset] (src/services/AssetService.js:58:17)

    console.log
      Γ£à S3 upload successful: promotional/justawomaninperprime/raw/1767744677548-d6e8afcd-9362-4657-b822-81a07bfb86d2.jpg

      at AssetService.log [as uploadAsset] (src/services/AssetService.js:72:17)

    console.log
      ≡ƒôñ Uploading to S3: promotional/guests/raw/1767744677620-94bddaac-7903-4fd9-bc90-0764357d178b.jpg

      at AssetService.log [as uploadAsset] (src/services/AssetService.js:58:17)

    console.log
      Γ£à S3 upload successful: promotional/guests/raw/1767744677620-94bddaac-7903-4fd9-bc90-0764357d178b.jpg

      at AssetService.log [as uploadAsset] (src/services/AssetService.js:72:17)

    console.log
      ≡ƒôñ Uploading to S3: promotional/brands/1767744677691-423747ad-98d5-4bd6-89de-64f8272cbb26.jpg

      at AssetService.log [as uploadAsset] (src/services/AssetService.js:58:17)

    console.log
      Γ£à S3 upload successful: promotional/brands/1767744677691-423747ad-98d5-4bd6-89de-64f8272cbb26.jpg

      at AssetService.log [as uploadAsset] (src/services/AssetService.js:72:17)

    console.log
      ≡ƒôñ Uploading to S3: thumbnails/auto/1767744677764-bcbd58ee-6734-4053-b30a-fbf6421acaec.jpg

      at AssetService.log [as uploadAsset] (src/services/AssetService.js:58:17)

    console.log
      Γ£à S3 upload successful: thumbnails/auto/1767744677764-bcbd58ee-6734-4053-b30a-fbf6421acaec.jpg

      at AssetService.log [as uploadAsset] (src/services/AssetService.js:72:17)

    console.log
      ≡ƒôñ Uploading to S3: promotional/lala/raw/1767744677844-15b3d0d8-273d-4e29-bdea-7f5182110f0b.jpg

      at AssetService.log [as uploadAsset] (src/services/AssetService.js:58:17)

    console.log
      Γ£à S3 upload successful: promotional/lala/raw/1767744677844-15b3d0d8-273d-4e29-bdea-7f5182110f0b.jpg

      at AssetService.log [as uploadAsset] (src/services/AssetService.js:72:17)

    console.log
      ≡ƒôñ Uploading to S3: promotional/lala/raw/1767744677918-ea867191-24c9-4403-a0fc-520507d1bcf2.jpg

      at AssetService.log [as uploadAsset] (src/services/AssetService.js:58:17)

    console.log
      Γ£à S3 upload successful: promotional/lala/raw/1767744677918-ea867191-24c9-4403-a0fc-520507d1bcf2.jpg

      at AssetService.log [as uploadAsset] (src/services/AssetService.js:72:17)

    console.error
      Failed to get asset: Error: Asset not found
          at AssetService.getAsset (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\src\services\AssetService.js:139:15)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\src\routes\assets.js:109:19

      145 |       };
      146 |     } catch (error) {
    > 147 |       console.error('Failed to get asset:', error);
          |               ^
      148 |       throw error;
      149 |     }
      150 |   }

      at AssetService.error [as getAsset] (src/services/AssetService.js:147:15)
      at src/routes/assets.js:109:19

    console.error
      Failed to get asset: Error: Asset not found
          at AssetService.getAsset (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\src\services\AssetService.js:139:15)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\src\routes\assets.js:109:19

      120 |     });
      121 |   } catch (error) {
    > 122 |     console.error('Failed to get asset:', error);
          |             ^
      123 |     // Check if error is "Asset not found"
      124 |     if (error.message.includes('Asset not found')) {
      125 |       return res.status(404).json({

      at error (src/routes/assets.js:122:13)

    console.error
      Failed to get asset: Error: Asset not found
          at AssetService.getAsset (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\src\services\AssetService.js:139:15)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\src\routes\assets.js:109:19

      145 |       };
      146 |     } catch (error) {
    > 147 |       console.error('Failed to get asset:', error);
          |               ^
      148 |       throw error;
      149 |     }
      150 |   }

      at AssetService.error [as getAsset] (src/services/AssetService.js:147:15)
      at src/routes/assets.js:109:19

    console.error
      Failed to get asset: Error: Asset not found
          at AssetService.getAsset (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\src\services\AssetService.js:139:15)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\src\routes\assets.js:109:19

      120 |     });
      121 |   } catch (error) {
    > 122 |     console.error('Failed to get asset:', error);
          |             ^
      123 |     // Check if error is "Asset not found"
      124 |     if (error.message.includes('Asset not found')) {
      125 |       return res.status(404).json({

      at error (src/routes/assets.js:122:13)

PASS tests/integration/auth.integration.test.js
  ΓùÅ Console

    console.log
      ≡ƒÜÇ Starting Episode Metadata API...

      at Object.log (src/app.js:75:9)

    console.log
      ≡ƒôª Node version: v20.19.4

      at Object.log (src/app.js:76:9)

    console.log
      ≡ƒöº Environment: test

      at Object.log (src/app.js:77:9)

    console.log
      Γ£ô Auth routes loaded

      at Object.log (src/app.js:163:11)

    console.log
      Γ£ô Episodes routes loaded

      at Object.log (src/app.js:179:11)

    console.log
      Γ£ô Thumbnails routes loaded

      at Object.log (src/app.js:187:11)

    console.log
      Γ£ô Metadata routes loaded

      at Object.log (src/app.js:195:11)

    console.log
      Γ£ô Processing routes loaded

      at Object.log (src/app.js:203:11)

    console.log
      Γ£ô Files routes loaded

      at Object.log (src/app.js:212:11)

    console.log
      Γ£ô Search routes loaded

      at Object.log (src/app.js:220:11)

    console.log
      Γ£ô Jobs routes loaded

      at Object.log (src/app.js:228:11)

    console.log
      Γ£ô Assets routes loaded

      at Object.log (src/app.js:237:11)

    console.log
      Γ£ô Compositions routes loaded

      at Object.log (src/app.js:245:11)

    console.log
      Γ£ô Templates routes loaded

      at Object.log (src/app.js:253:11)

    console.log
      Γ£ô Seed routes loaded (development only)

      at Object.log (src/app.js:263:11)

    console.log
      Γ£à AWS SDK v3 configured with credentials from profile: default

      at log (src/routes/compositions.js:39:11)

    console.error
      Token refresh error: Error: Token refresh failed: Token has expired
          at Function.refreshAccessToken (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\src\services\tokenService.js:175:13)
          at refreshAccessToken (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\src\routes\auth.js:124:36)
          at Layer.handle [as handle_request] (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\express\lib\router\layer.js:95:5)
          at next (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\express\lib\router\route.js:149:13)
          at next (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\src\middleware\requestValidation.js:98:5)
          at Layer.handle [as handle_request] (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\express\lib\router\layer.js:95:5)
          at next (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\express\lib\router\route.js:149:13)
          at C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\express-rate-limit\dist\index.cjs:706:9
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\express-rate-limit\dist\index.cjs:691:5

      134 |     });
      135 |   } catch (error) {
    > 136 |     console.error('Token refresh error:', error);
          |             ^
      137 |     return res.status(401).json({
      138 |       error: 'Unauthorized',
      139 |       message: error.message,

      at error (src/routes/auth.js:136:13)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/requestValidation.js:98:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at node_modules/express-rate-limit/dist/index.cjs:706:9
      at node_modules/express-rate-limit/dist/index.cjs:691:5

    console.warn
      Optional auth token invalid: Token verification failed: Invalid token format

      156 |     } catch (error) {
      157 |       // Log but don't fail - user is optional
    > 158 |       console.warn('Optional auth token invalid:', error.message);
          |               ^
      159 |       req.user = null;
      160 |     }
      161 |

      at warn (src/middleware/auth.js:158:15)

    console.warn
      Optional auth token invalid: Token verification failed: Invalid token format

      156 |     } catch (error) {
      157 |       // Log but don't fail - user is optional
    > 158 |       console.warn('Optional auth token invalid:', error.message);
          |               ^
      159 |       req.user = null;
      160 |     }
      161 |

      at warn (src/middleware/auth.js:158:15)

PASS tests/unit/app.test.js
  ΓùÅ Console

    console.log
      ≡ƒÜÇ Starting Episode Metadata API...

      at Object.log (src/app.js:75:9)

    console.log
      ≡ƒôª Node version: v20.19.4

      at Object.log (src/app.js:76:9)

    console.log
      ≡ƒöº Environment: test

      at Object.log (src/app.js:77:9)

    console.log
      Γ£ô Auth routes loaded

      at Object.log (src/app.js:163:11)

    console.log
      Γ£ô Episodes routes loaded

      at Object.log (src/app.js:179:11)

    console.log
      Γ£ô Thumbnails routes loaded

      at Object.log (src/app.js:187:11)

    console.log
      Γ£ô Metadata routes loaded

      at Object.log (src/app.js:195:11)

    console.log
      Γ£ô Processing routes loaded

      at Object.log (src/app.js:203:11)

    console.log
      Γ£ô Files routes loaded

      at Object.log (src/app.js:212:11)

    console.log
      Γ£ô Search routes loaded

      at Object.log (src/app.js:220:11)

    console.log
      Γ£ô Jobs routes loaded

      at Object.log (src/app.js:228:11)

    console.log
      Γ£ô Assets routes loaded

      at Object.log (src/app.js:237:11)

    console.log
      Γ£ô Compositions routes loaded

      at Object.log (src/app.js:245:11)

    console.log
      Γ£ô Templates routes loaded

      at Object.log (src/app.js:253:11)

    console.log
      Γ£ô Seed routes loaded (development only)

      at Object.log (src/app.js:263:11)


  ΓùÅ  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Γ£à AWS SDK v3 configured with credentials from profile: default".

      37 | (async () => {
      38 |   s3Client = await createS3Client();
    > 39 |   console.log('Γ£à AWS SDK v3 configured with credentials from', process.env.AWS_PROFILE ? `profile: ${process.env.AWS_PROFILE}` : 'environment');
         |           ^
      40 | })();
      41 |
      42 | const router = express.Router();

      at console.log (node_modules/@jest/console/build/BufferedConsole.js:156:10)
      at log (src/routes/compositions.js:39:11)

PASS tests/unit/controllers/processing.test.js
PASS tests/unit/middleware/auditLog.test.js
  ΓùÅ Console

    console.error
      Error logging action: Error: DB error
          at Object.<anonymous> (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\tests\unit\middleware\auditLog.test.js:82:28)
          at Promise.then.completed (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\utils.js:231:10)
          at _callCircusTest (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:316:40)
          at _runTest (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:252:3)
          at _runTestsForDescribeBlock (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:126:9)
          at _runTestsForDescribeBlock (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:121:9)
          at _runTestsForDescribeBlock (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:121:9)
          at run (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:71:3)
          at runAndTransformResultsToJestFormat (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
          at jestAdapter (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
          at runTestInternal (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-runner\build\runTest.js:367:16)
          at runTest (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-runner\build\runTest.js:444:34)

      182 |       });
      183 |     } catch (error) {
    > 184 |       console.error('Error logging action:', error);
          |               ^
      185 |       return null;
      186 |     }
      187 |   },

      at Object.error [as logAction] (src/middleware/auditLog.js:184:15)
      at Object.<anonymous> (tests/unit/middleware/auditLog.test.js:85:22)

    console.error
      Error fetching user history: Error: DB error
          at Object.<anonymous> (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\tests\unit\middleware\auditLog.test.js:110:71)
          at Promise.then.completed (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\utils.js:231:10)
          at _callCircusTest (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:316:40)
          at _runTest (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:252:3)
          at _runTestsForDescribeBlock (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:126:9)
          at _runTestsForDescribeBlock (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:121:9)
          at _runTestsForDescribeBlock (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:121:9)
          at run (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:71:3)
          at runAndTransformResultsToJestFormat (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
          at jestAdapter (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
          at runTestInternal (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-runner\build\runTest.js:367:16)
          at runTest (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-runner\build\runTest.js:444:34)

      198 |       return await ActivityLog.getUserHistory(userId, options);
      199 |     } catch (error) {
    > 200 |       console.error('Error fetching user history:', error);
          |               ^
      201 |       return [];
      202 |     }
      203 |   },

      at Object.error [as getUserHistory] (src/middleware/auditLog.js:200:15)
      at Object.<anonymous> (tests/unit/middleware/auditLog.test.js:112:20)

    console.error
      Error fetching resource history: Error: error
          at Object.<anonymous> (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\tests\unit\middleware\auditLog.test.js:132:75)
          at Promise.then.completed (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\utils.js:231:10)
          at _callCircusTest (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:316:40)
          at _runTest (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:252:3)
          at _runTestsForDescribeBlock (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:126:9)
          at _runTestsForDescribeBlock (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:121:9)
          at _runTestsForDescribeBlock (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:121:9)
          at run (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:71:3)
          at runAndTransformResultsToJestFormat (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
          at jestAdapter (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
          at runTestInternal (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-runner\build\runTest.js:367:16)
          at runTest (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-runner\build\runTest.js:444:34)

      214 |       return await ActivityLog.getResourceHistory(resourceType, resourceId);
      215 |     } catch (error) {
    > 216 |       console.error('Error fetching resource history:', error);
          |               ^
      217 |       return [];
      218 |     }
      219 |   },

      at Object.error [as getResourceHistory] (src/middleware/auditLog.js:216:15)
      at Object.<anonymous> (tests/unit/middleware/auditLog.test.js:134:20)

    console.error
      Error fetching audit trail: Error: error
          at Object.<anonymous> (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\tests\unit\middleware\auditLog.test.js:158:70)
          at Promise.then.completed (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\utils.js:231:10)
          at _callCircusTest (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:316:40)
          at _runTest (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:252:3)
          at _runTestsForDescribeBlock (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:126:9)
          at _runTestsForDescribeBlock (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:121:9)
          at _runTestsForDescribeBlock (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:121:9)
          at run (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:71:3)
          at runAndTransformResultsToJestFormat (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
          at jestAdapter (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
          at runTestInternal (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-runner\build\runTest.js:367:16)
          at runTest (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-runner\build\runTest.js:444:34)

      230 |       return await ActivityLog.getAuditTrail(options);
      231 |     } catch (error) {
    > 232 |       console.error('Error fetching audit trail:', error);
          |               ^
      233 |       return [];
      234 |     }
      235 |   },

      at Object.error [as getAuditTrail] (src/middleware/auditLog.js:232:15)
      at Object.<anonymous> (tests/unit/middleware/auditLog.test.js:160:21)

    console.error
      Error fetching stats: Error: error
          at Object.<anonymous> (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\tests\unit\middleware\auditLog.test.js:182:65)
          at Promise.then.completed (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\utils.js:231:10)
          at _callCircusTest (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:316:40)
          at _runTest (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:252:3)
          at _runTestsForDescribeBlock (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:126:9)
          at _runTestsForDescribeBlock (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:121:9)
          at _runTestsForDescribeBlock (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:121:9)
          at run (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:71:3)
          at runAndTransformResultsToJestFormat (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
          at jestAdapter (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
          at runTestInternal (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-runner\build\runTest.js:367:16)
          at runTest (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-runner\build\runTest.js:444:34)

      246 |       return await ActivityLog.getStats(timeRange);
      247 |     } catch (error) {
    > 248 |       console.error('Error fetching stats:', error);
          |               ^
      249 |       return {};
      250 |     }
      251 |   },

      at Object.error [as getStats] (src/middleware/auditLog.js:248:15)
      at Object.<anonymous> (tests/unit/middleware/auditLog.test.js:184:21)

    console.error
      Error logging action: Error: Connection error
          at Object.<anonymous> (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\tests\unit\middleware\auditLog.test.js:492:68)
          at Promise.then.completed (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\utils.js:231:10)
          at _callCircusTest (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:316:40)
          at _runTest (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:252:3)
          at _runTestsForDescribeBlock (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:126:9)
          at _runTestsForDescribeBlock (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:121:9)
          at _runTestsForDescribeBlock (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:121:9)
          at run (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:71:3)
          at runAndTransformResultsToJestFormat (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
          at jestAdapter (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
          at runTestInternal (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-runner\build\runTest.js:367:16)
          at runTest (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-runner\build\runTest.js:444:34)

      182 |       });
      183 |     } catch (error) {
    > 184 |       console.error('Error logging action:', error);
          |               ^
      185 |       return null;
      186 |     }
      187 |   },

      at Object.error [as logAction] (src/middleware/auditLog.js:184:15)
      at Object.<anonymous> (tests/unit/middleware/auditLog.test.js:494:22)

    console.error
      Error fetching stats: Error: Stats error
          at Object.<anonymous> (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\tests\unit\middleware\auditLog.test.js:668:65)
          at Promise.then.completed (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\utils.js:231:10)
          at _callCircusTest (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:316:40)
          at _runTest (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:252:3)
          at _runTestsForDescribeBlock (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:126:9)
          at _runTestsForDescribeBlock (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:121:9)
          at _runTestsForDescribeBlock (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:121:9)
          at run (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:71:3)
          at runAndTransformResultsToJestFormat (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
          at jestAdapter (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
          at runTestInternal (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-runner\build\runTest.js:367:16)
          at runTest (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-runner\build\runTest.js:444:34)

      246 |       return await ActivityLog.getStats(timeRange);
      247 |     } catch (error) {
    > 248 |       console.error('Error fetching stats:', error);
          |               ^
      249 |       return {};
      250 |     }
      251 |   },

      at Object.error [as getStats] (src/middleware/auditLog.js:248:15)
      at Object.<anonymous> (tests/unit/middleware/auditLog.test.js:670:21)

PASS tests/unit/controllers/episode.test.js
  ΓùÅ Console

    console.error
      Γ¥î Error in listEpisodes: Error: DB connection failed
          at Object.<anonymous> (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\tests\unit\controllers\episode.test.js:475:23)
          at Promise.then.completed (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\utils.js:231:10)
          at _callCircusTest (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:316:40)
          at _runTest (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:252:3)
          at _runTestsForDescribeBlock (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:126:9)
          at _runTestsForDescribeBlock (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:121:9)
          at _runTestsForDescribeBlock (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:121:9)
          at run (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:71:3)
          at runAndTransformResultsToJestFormat (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
          at jestAdapter (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
          at runTestInternal (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-runner\build\runTest.js:367:16)
          at runTest (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-runner\build\runTest.js:444:34)

      61 |       });
      62 |     } catch (error) {
    > 63 |       console.error('Γ¥î Error in listEpisodes:', error);
         |               ^
      64 |       res.status(500).json({
      65 |         error: 'Failed to list episodes',
      66 |         message: error.message

      at Object.error [as listEpisodes] (src/controllers/episodeController.js:63:15)
      at Object.<anonymous> (tests/unit/controllers/episode.test.js:478:7)

PASS tests/unit/controllers/thumbnail.test.js
  ΓùÅ Console

    console.error
      Γ¥î Error in listThumbnails: Error: DB error
          at Object.<anonymous> (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\tests\unit\controllers\thumbnail.test.js:321:70)
          at Promise.then.completed (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\utils.js:231:10)
          at _callCircusTest (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:316:40)
          at _runTest (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:252:3)
          at _runTestsForDescribeBlock (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:126:9)
          at _runTestsForDescribeBlock (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:121:9)
          at _runTestsForDescribeBlock (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:121:9)
          at run (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\run.js:71:3)
          at runAndTransformResultsToJestFormat (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
          at jestAdapter (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
          at runTestInternal (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-runner\build\runTest.js:367:16)
          at runTest (C:\Users\12483\prime studios\BRD\Episode-Canonical-Control-Record\node_modules\jest-runner\build\runTest.js:444:34)

      63 |       });
      64 |     } catch (error) {
    > 65 |       console.error('Γ¥î Error in listThumbnails:', error);
         |               ^
      66 |       res.status(500).json({
      67 |         error: 'Failed to list thumbnails',
      68 |         message: error.message

      at Object.error [as listThumbnails] (src/controllers/thumbnailController.js:65:15)
      at Object.<anonymous> (tests/unit/controllers/thumbnail.test.js:323:7)

PASS tests/unit/controllers/metadata.test.js
  ΓùÅ Console

    console.error
      Metadata query error (schema mismatch): DB error

      60 |     } catch (error) {
      61 |       // If metadata table schema is mismatched, return empty list
    > 62 |       console.error('Metadata query error (schema mismatch):', error.message);
         |               ^
      63 |       res.json({
      64 |         data: [],
      65 |         pagination: {

      at Object.error [as listMetadata] (src/controllers/metadataController.js:62:15)
      at Object.<anonymous> (tests/unit/controllers/metadata.test.js:296:7)

PASS tests/unit/middleware/auditLog-additional.test.js
PASS tests/unit/middleware/errorHandler.test.js
PASS tests/unit/services/JobQueueService.test.js
PASS tests/unit/services/OpenSearchService.test.js
PASS tests/unit/middleware/jwtAuth.test.js
PASS tests/unit/middleware/auth.test.js
PASS tests/api/endpoints.test.js
PASS tests/unit/services/S3Service.test.js
PASS tests/unit/models/metadata-methods.test.js
PASS tests/unit/services/FileValidationService.test.js
PASS tests/unit/models/activityLog.test.js
PASS tests/unit/controllers/jobController.test.js
PASS tests/unit/controllers/fileController.test.js
PASS tests/unit/models/episode.test.js
PASS tests/unit/controllers/searchController.test.js
PASS tests/unit/middleware/auth-gaps.test.js
-----------------------------------------------------|---------|----------|---------|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
File                                                 | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                                                                                                                                                           
-----------------------------------------------------|---------|----------|---------|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
All files                                            |   53.38 |    40.55 |   47.88 |   53.98 |                                                                                                                                                                             
 src                                                 |   47.64 |    30.43 |    7.69 |   50.83 |                                                                                                                                                                             
  app.js                                             |   55.69 |    32.14 |      10 |   60.27 | 20-53,62,66-68,85,97,142-148,165-166,181-182,189-190,197-198,205-206,214-215,222-223,230-231,239-240,247-248,255-256,265-266,289,326-328                                    
  db.js                                              |      75 |       50 |       0 |      75 | 13                                                                                                                                                                          
  server.js                                          |       0 |        0 |       0 |       0 | 7-76                                                                                                                                                                        
 src/config                                          |       0 |        0 |       0 |       0 |                                                                                                                                                                             
  aws.js                                             |       0 |        0 |     100 |       0 | 7-17                                                                                                                                                                        
  database.js                                        |       0 |        0 |       0 |       0 | 7-36                                                                                                                                                                        
  environment.js                                     |       0 |        0 |     100 |       0 | 5-47                                                                                                                                                                        
  sequelize.js                                       |       0 |        0 |     100 |       0 | 6                                                                                                                                                                           
 src/controllers                                     |   82.94 |    59.73 |    94.2 |   83.02 |                                                                                                                                                                             
  episodeController.js                               |   77.89 |    54.11 |     100 |   77.89 | 36-41,92-93,169-170,225-237,279                                                                                                                                             
  fileController.js                                  |   84.72 |    77.77 |   83.33 |   86.95 | 236-266                                                                                                                                                                     
  jobController.js                                   |     100 |      100 |     100 |     100 |                                                                                                                                                                             
  metadataController.js                              |   72.34 |    46.66 |      90 |   72.04 | 91,118,153,162,214,237-245,294,327,335,365-406,420                                                                                                                          
  processingController.js                            |   88.65 |    67.85 |     100 |   89.36 | 86,111,123,134,178,185,202,235,284,327                                                                                                                                      
  searchController.js                                |   89.58 |      100 |   88.88 |   88.88 | 98-104                                                                                                                                                                      
  thumbnailController.js                             |   77.08 |    36.84 |    90.9 |   76.59 | 104,112-192,207,224,258,292,325,377,412                                                                                                                                     
 src/middleware                                      |    74.9 |    69.16 |   74.35 |   75.39 |                                                                                                                                                                             
  auditLog.js                                        |   69.76 |    58.82 |    64.7 |   70.23 | 67-78,110-116,126-155,170,195,211,227,243                                                                                                                                   
  auth.js                                            |   71.42 |    58.13 |      50 |   72.46 | 50,69,114,137-138,164-166,175-192,206-222                                                                                                                                   
  errorHandler.js                                    |     100 |    95.18 |     100 |     100 | 66-75,193,233                                                                                                                                                               
  jwtAuth.js                                         |      40 |    32.35 |   28.57 |   40.74 | 61,74-111,123-139,148-167                                                                                                                                                   
  rbac.js                                            |   93.44 |    90.32 |   85.71 |   93.33 | 75,90,148,185                                                                                                                                                               
  requestValidation.js                               |   83.92 |    82.71 |     100 |   84.68 | 37,41,48,52,66,85,100,119,134,154,188,208,221,236,273-274,287                                                                                                               
  searchLogger.js                                    |   21.42 |        0 |       0 |   21.42 | 15-41                                                                                                                                                                       
  uploadValidation.js                                |      20 |        0 |       0 |      20 | 15-61                                                                                                                                                                       
 src/migrations                                      |       0 |        0 |       0 |       0 |                                                                                                                                                                             
  20240101000001-create-episodes.js                  |       0 |      100 |       0 |       0 | 3-125                                                                                                                                                                       
  20240101000002-create-metadata-storage.js          |       0 |      100 |       0 |       0 | 3-67                                                                                                                                                                        
  20240101000003-create-thumbnails.js                |       0 |      100 |       0 |       0 | 3-87                                                                                                                                                                        
  20240101000004-create-processing-queue.js          |       0 |      100 |       0 |       0 | 3-92                                                                                                                                                                        
  20240101000005-create-activity-logs.js             |       0 |      100 |       0 |       0 | 3-73                                                                                                                                                                        
  20260104000001-add-justawomaninherprime-support.js |       0 |      100 |       0 |       0 | 11-77                                                                                                                                                                       
  20260104000002-update-composition-workflow.js      |       0 |      100 |       0 |       0 | 10-75                                                                                                                                                                       
  20260106000001-add-categories-to-episodes.js       |       0 |        0 |       0 |       0 | 3-31                                                                                                                                                                        
 src/models                                          |   45.23 |        0 |   18.36 |   46.06 |                                                                                                                                                                             
  ActivityLog.js                                     |    37.5 |        0 |   16.66 |   42.85 | 117,133,144,154-164,174-189                                                                                                                                                 
  Asset.js                                           |     100 |      100 |     100 |     100 |                                                                                                                                                                             
  Episode.js                                         |   46.42 |        0 |      10 |   46.42 | 235-236,243-244,251-255,262,280,287,297,306-309,316                                                                                                                         
  FileStorage.js                                     |   71.42 |      100 |      50 |   71.42 | 130-135                                                                                                                                                                     
  MetadataStorage.js                                 |      36 |        0 |   16.66 |      36 | 106-108,115-117,124-127,138,147-160                                                                                                                                         
  ProcessingQueue.js                                 |   35.55 |        0 |    7.69 |   35.55 | 137-139,146-148,155-158,165-173,180,187-190,201,213,224,234,247,257-267                                                                                                     
  Thumbnail.js                                       |   44.44 |        0 |   11.11 |   44.44 | 190-191,198-201,208-212,223,235,248,261-273,280                                                                                                                             
  ThumbnailComposition.js                            |     100 |      100 |     100 |     100 |                                                                                                                                                                             
  ThumbnailTemplate.js                               |     100 |      100 |     100 |     100 |                                                                                                                                                                             
 src/routes                                          |    41.3 |     15.1 |   21.73 |   42.35 |                                                                                                                                                                             
  assets.js                                          |   54.08 |    47.22 |    62.5 |   54.08 | 43,72-73,94-95,111-117,129,154,161,174-177,185-191,212-213,226-243,255-274,286-316                                                                                          
  auth.js                                            |      80 |    73.33 |     100 |      80 | 47,56,99-100,117,154,175-176,213-214,236-237,254                                                                                                                            
  compositions.js                                    |   12.87 |      1.5 |    6.45 |   12.95 | 48-49,57-79,92-230,243-254,266-276,288-307,319-330,342-353,365-391,403-413,426-596,610-664,676-695,707-731,742-754,765-778,789-810,821-845,856-879,890-903,929-974,990-1000 
  episodes.js                                        |     100 |      100 |     100 |     100 |                                                                                                                                                                             
  files.js                                           |   79.16 |      100 |       0 |     100 |                                                                                                                                                                             
  jobs.js                                            |   66.66 |      100 |       0 |     100 |                                                                                                                                                                             
  metadata.js                                        |     100 |      100 |     100 |     100 |                                                                                                                                                                             
  processing.js                                      |     100 |      100 |     100 |     100 |                                                                                                                                                                             
  search.js                                          |   71.42 |      100 |       0 |     100 |                                                                                                                                                                             
  seed.js                                            |   41.17 |        0 |       0 |   41.17 | 108-136                                                                                                                                                                     
  templates.js                                       |   35.29 |        0 |       0 |   35.29 | 17-27,39-49                                                                                                                                                                 
  thumbnails.js                                      |      50 |        0 |       0 |      50 | 96-105,117-125,137-145,156-164                                                                                                                                              
 src/services                                        |   38.72 |    27.38 |   48.64 |   38.97 |                                                                                                                                                                             
  AssetService.js                                    |   57.31 |    36.36 |   76.92 |   58.02 | 38,74,101-102,127-128,142,156-201,223-234                                                                                                                                   
  CompositionService.js                              |    3.57 |        0 |       0 |    3.75 | 16-392                                                                                                                                                                      
  FileValidationService.js                           |     100 |    97.22 |     100 |     100 | 141                                                                                                                                                                         
  FilterService.js                                   |       2 |        0 |       0 |       2 | 43-347                                                                                                                                                                      
  JobQueueService.js                                 |   96.36 |    66.66 |   91.66 |   98.11 | 95                                                                                                                                                                          
  OpenSearchService.js                               |   57.14 |       50 |   71.42 |   56.75 | 37-93,105-106,135-136,166-167,194-249,261-262,390-399                                                                                                                       
  RunwayMLService.js                                 |   17.94 |        0 |   16.66 |   17.94 | 21-129                                                                                                                                                                      
  S3Service.js                                       |   95.83 |    66.66 |     100 |   95.74 | 155-160                                                                                                                                                                     
  ThumbnailGeneratorService.js                       |    7.14 |        0 |       0 |    7.27 | 52-350                                                                                                                                                                      
  ThumbnailService.js                                |       0 |        0 |       0 |       0 | 1-174                                                                                                                                                                       
  VersioningService.js                               |    4.44 |        0 |       0 |    4.44 | 16-292                                                                                                                                                                      
  tokenService.js                                    |   83.05 |    57.37 |     100 |   83.05 | 24,28,54-55,97-98,110,115,127,142                                                                                                                                           
 src/utils                                           |   41.66 |    21.42 |      25 |   41.66 |                                                                                                                                                                             
  logger.js                                          |   41.66 |    21.42 |      25 |   41.66 | 17-18,24-36                                                                                                                                                                 
-----------------------------------------------------|---------|----------|---------|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Summary of all failing tests
FAIL tests/integration/episodes.integration.test.js
  ΓùÅ Episodes API Integration Tests ΓÇ║ GET /api/v1/episodes ΓÇ║ should filter by status

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

      70 |         .query({ status: 'approved', page: 1, limit: 10 });
      71 |
    > 72 |       expect(res.status).toBe(200);
         |                          ^
      73 |       if (res.body.data.length > 0) {
      74 |         res.body.data.forEach(episode => {
      75 |           expect(episode.status?.toLowerCase()).toBe('approved');

      at Object.toBe (tests/integration/episodes.integration.test.js:72:26)

  ΓùÅ Episodes API Integration Tests ΓÇ║ GET /api/v1/episodes ΓÇ║ should handle multiple query parameters together

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

      116 |         });
      117 |
    > 118 |       expect(res.status).toBe(200);
          |                          ^
      119 |       expect(res.body).toHaveProperty('data');
      120 |       expect(res.body).toHaveProperty('pagination');
      121 |     });

      at Object.toBe (tests/integration/episodes.integration.test.js:118:26)

  ΓùÅ Episodes API Integration Tests ΓÇ║ End-to-End Episode Workflow ΓÇ║ should filter and browse episodes

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

      192 |         .query({ status: 'approved', page: 1, limit: 5 });
      193 |
    > 194 |       expect(approvedRes.status).toBe(200);
          |                                  ^
      195 |
      196 |       // Get pending episodes
      197 |       const pendingRes = await request(app)

      at Object.toBe (tests/integration/episodes.integration.test.js:194:34)

FAIL tests/unit/middleware/rbac.test.js
  ΓùÅ Edge Cases and Security Hardening ΓÇ║ should be case-sensitive for role names

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: 403

    Number of calls: 0

      624 |     middleware(req, res, next);
      625 |     
    > 626 |     expect(res.status).toHaveBeenCalledWith(403);
          |                        ^
      627 |   });
      628 |   
      629 |   it('should handle special characters in group names', () => {

      at Object.toHaveBeenCalledWith (tests/unit/middleware/rbac.test.js:626:24)


Test Suites: 2 failed, 24 passed, 26 total
Tests:       4 failed, 6 skipped, 819 passed, 829 total
Snapshots:   0 total
Time:        10.255 s
Ran all test suites.
Jest did not exit one second after the test run has completed.

'This usually means that there are asynchronous operations that weren't stopped in your tests. Consider running Jest with `--detectOpenHandles` to troubleshoot this issue.
